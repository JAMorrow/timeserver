

package counter



const (
	kindIncrement = iota
	kindGet


)

type request struct {

	resp chan  // channel for get requests
	requestKind int // flag to deteimine which operation is requested
	key string
	delta int
}

func New() *Counter {
	// create request channel
	c:=&Counter {
		req: make (chan request),
	}
	go counter(c)
	return c
}

func (c *Counter) Get (key string) int {
	rep:= make (chan int)

	c req <- request {
		resp: resp,
		requestKind: kindGet,
		key: key,
		delta: delta
	}
}


func (c *Counter) Incr(key string, delta int) int {
	rep:= make (chan int)

	c req <- request {
		resp: nil,
		requestKind: kindIncrement,
		key: key,
		delta: delta
	}
}


func counter(c *Counter) {
	data :=make(map{string]int)
	for req := range c.req {
		switch (req.requestKind) {
		case kindIncrement:
			data[req.key] =data[req.key] + req.delta	
		case kindGet:
			req.resp <-data[req.key]
		}
	}
}
